
#!/bin/sh
. common
sync

# Check if its running on privileged mode
echo 1 > $PROC/sys/vm/drop_caches >/dev/null 2>&1 || \
    throw 1 "Please re-run container with: --privileged"

# Check if /host/proc exists
[ -f $PROC/sys/net/ipv4/tcp_fin_timeout ] || \
    throw 2 "Please re-run container with: --net=host"

# Load tuners
TUNERS_PIDS=""
for FILE in $(ls tuner/); do
    if [ ! -z $(eval "echo \$TUNE_${FILE}") ]; then
        echo -ne "Starting up $FILE tuner..."
        /tunesys/tuner/$FILE &
        _PID=$!
        echo "Started! $_PID"
        TUNERS_PIDS="$TUNERS_PIDS $_PID"
    fi